#CICD Pipeline

trigger:
    branches:
        include:
        - main
        - deploy/*

        exclude:
        - hotfix/*
    batch: true

stages:
- stage: Build
  jobs:
  - job: CIJob
    pool:
      vmImage: 'ubuntu-latest'
    displayName: 'Build Job'
    steps:
    - template: '/Build/build-pipeline.yml'
      parameters:
          buildConfig: 'debug'
    - template: '/Build/build-pipeline.yml'
      parameters:
          buildConfig: 'release'
    
    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact Task'
      inputs:
        ArtifactName: 'depo'
        PathtoPublish: '$(build.artifactsstaging)'
        

- stage: Checks
  pool: server
  dependsOn: Build
  jobs:
  - job: Validation
    steps:
    - task: ManualValidation@1
      inputs:
        notifyUsers: |
          310538-PA7@deccansoftstudents.onmicrosoft.com
          1728233@kiit.ac.in
        approvers: '1728233@kiit.ac.in'
        instructions: '1728233@kiit.ac.in'

- stage: AWS
  dependsOn: Checks
  jobs:
  - job: ArtifactDownload
    steps:
    - task: DownloadBuildArtifacts@1
      displayName: 'Download Build Artifact'
      inputs:
        buildType: 'current'
        downloadType: 'single'
        artifactName: 'depo'
        itemPattern: 'depo/MyBuilds/debug'
        downloadPath: '$(system.artifactsstaging)'
    


